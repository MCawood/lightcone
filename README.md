Lightcone Toolkit v0.1
=========
January 2015

Matthew Cawood

Python toolkit for generating HI lightcones for GADGET simulations

This Python code was developed to process GADGET simulation data into synthetic lightcones.  It uses pyGadgetReader to read particle data from GADGET snapshots and processes this into a pixelised lightcone.  The output is stored as a large dense NumPy array (datacube).

1. Quick Start Guide
-------------------

To run the code, simply check that the params.txt is correctly configured with the path to your GADGET snapshots, then run the launcher.py file with your Python interpreter.

2. Requirements
-------------------
- Python >= 2.7.x  (developed with 2.7.6)  
- NumPy >= 1.7.x (developed with 1.8.1)
- SciPy >= 0.14.0 (developed with 0.14.0)
- pyGadgetReader (avaliable from: https://bitbucket.org/rthompson/pygadgetreader)

3. Installation
-------------------
No installation is required, just ensure that the above software packages are installed and are sourced.  

4. Configuration
-------------------
The params.txt file contains all the user configurable parameters for this toolkit.  The contents of which are:

- CUBESIZE=[size of GADGET simulation cube is Mpcs]
- CONEAXISVECTOR=[a comma delimited 3D vector describing the axis along which the cone will be created.  (0,0,0) represents the direction of snapshot stackking]
- ZMAX=[the maximum redshift of the lightcone, this will determine the number of stacked snapshots]
- NCPUS=[number of CPU cores to run the snapshot processing stage on]
- DM=[YES/NO - toggles whether to add dark matter to the output datacube]
- SNAPNAME=[the full path and filename to the input GADGET snapshots, with X used to represent the number section of the file name]
- X=[the number of the last GADGET snapshot, representing z=0, eg: 141]
- PIXELS=[the number of spatial pixels into which the lightcone will be partitioned along each spatial axis]
- FREQBINS=[number of frequency channels into which the lightcone will be partitioned]
- DIAG=[YES/NO, toggles additional output generation used for developement and debugging]

A sample params.txt file is included to demonstrate the correct format.

5. File Discriptions
-------------------
##### CODE:
launcher.py = This is the main file for this code.  To start execution, simply execute this file with your python interpreter.  This file performs several checks and initialization steps, then spawns threads (cube.py) in a queue to process GADGET snapshots.  upon complete, the postProcessor.py file is executed.

cube.py = This file contains the bulk of the program.  This Python code is executed with a cubeID passed as a command like arguement.  Using this ID, the code selects a GADGET snapshot and tests and bins particles into the lightcone section contained within that snapshot.

postProcessor.py = After the individual lightcone sections are processed. This code merges the subsections together into one large 4D datacube and saves it to dataCube.npy.  This file can also perform other post processing tasks like extracting subsets of the data.

##### INPUTS:
params.txt = This file contains all the user configurable parameters for the code.

zr.txt = This file contains a list of 5000 data points used to generate an interpolation function for mapping co-moving distances to redshifts, and vicer verser (upto a redshift of z=5.0).

##### OUTPUTS:
cube_offsets.txt = A file generated to store the relative offsets of the lightcone subsections, it is used to correctly merge the subsections by the postProcessor.py code.

dataCube.npy = The main datacube generated by this code.  In the case where dark matter is disabled in params.txt, it will have dimensionality of [FREQBINS, PIXELS, PIXELS, 11]. With dark matter turned on, it will instead be [FREQBINS, PIXELS, PIXELS, 13].  The datacube is stored as 32bit single precision floats. 

|Array position    |Contents  |
| ------------- |:-------------|
|0                 |Gas particle count [GADGET particles]     |     
|1                 |Redshift Minimum |
|2                 |Delta Redshift Fixed|
|3                 |Ionised gas mass [MSun]|
|4                 |HI gas mass [MSun]|
|5                 |H2 gas mass [MSun]|
|6                 |Flux spectral density [W/m2/Hz]|
|7                 |Line-of-sight peculiar Velocity [km/s]|
|8                 |Star formation rate [MSun/yr]|
|9                 |Star particle count [GADGET particles] |
|10                |Stellar Mass [MSun]|
|11                |(Optional) Dark matter particle count [GADGET particles] |
|12                |(Optional) Dark matter mass [MSun]|

In addition, a number of log and data files are generated by the code, these files are stored in the 'data' and 'logs' directories.  


